id: aws-kinesis-json
namespace: company.team

tasks:
  - id: put_records_simple_map
    type: io.kestra.plugin.aws.kinesis.PutRecords
    streamName: kestra
    records:
      - data: sign-in
        partitionKey: user1
      - data: sign-out
        partitionKey: user1

  - id: extract
    type: io.kestra.plugin.core.http.Download
    uri: https://huggingface.co/datasets/kestra/datasets/resolve/main/json/user_events.json

  - id: json_to_ion
    type: io.kestra.plugin.serdes.json.JsonToIon
    from: "{{ outputs.extract.uri }}"
    newLine: false

  - id: put_records
    type: io.kestra.plugin.aws.kinesis.PutRecords
    streamName: kestra
    records: "{{ outputs.json_to_ion.uri }}"

extend:
  title: Stream JSON and Application Events to AWS Kinesis Data Streams at Scale
  description: |
    This blueprint shows how to **publish multiple records to AWS Kinesis Data
    Streams**, using either inline event definitions or JSON payloads fetched
    from an external API.

    The flow demonstrates two common ingestion patterns:

    - **Inline event streaming**, where records are defined as simple key/value
      maps and sent directly to Kinesis.
    - **API-driven streaming**, where JSON data is downloaded from an HTTP
      endpoint, converted to Amazon ION format, and then published to Kinesis
      in bulk.

    When ingesting data from APIs or files, the JSON payload must be converted
    to **ION**, the format required by the AWS Kinesis `PutRecords` API to enable
    row-by-row processing. This conversion is handled automatically using the
    `JsonToIon` task.

    The Outputs tab displays the shard ID and sequence number for each record
    successfully written to the stream. These values can be used to retrieve
    records later using the AWS `GetRecords` API.

    Important note: the `data` field sent to Kinesis **must be a string**. If
    you need to send structured JSON objects, wrap them as strings. A valid
    example is shown in the [following
    Gist](https://gist.githubusercontent.com/anna-geller/0b8ca0df9f4af137fc92346b360be4a7/raw/f5e7c3e1831e3d9e83d7854d133740216d82ab8d/user_events2.json).
    In contrast, [this
    payload](https://gist.githubusercontent.com/anna-geller/1db78ffc652f26a9904959a0040ad73c/raw/d2e630127c634c20932835e50359e933ea10493f/user_events.json)
    will not work.

    This pattern is ideal for **real-time data ingestion**, **event streaming**,
    **analytics pipelines**, and **event-driven architectures** built on AWS.
  tags:
    - Cloud
  ee: false
  demo: false
  meta_description: |
    Stream application events and JSON data to AWS Kinesis Data Streams.
    Send inline records or ingest API payloads by converting JSON to ION for
    scalable, real-time streaming.
