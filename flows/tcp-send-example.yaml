id: tcp-send-example
namespace: company.team

inputs:
  - id: host
    type: STRING
    defaults: "127.0.0.1"
    description: Target TCP host or IP address that accepts the message.
  - id: port
    type: INT
    defaults: 9090
    description: TCP port on the destination host.
  - id: payload
    type: STRING
    defaults: "Hello from Kestra"
    description: Message body to send to the TCP service.

tasks:
  - id: check_port
    type: io.kestra.plugin.scripts.shell.Commands
    description: Verify the TCP port is reachable before sending the payload.
    commands:
      - bash -lc "cat < /dev/null >/dev/tcp/{{ inputs.host }}/{{ inputs.port }}"

  - id: log_inputs
    type: io.kestra.plugin.core.log.Log
    message: "Sending TCP payload '{{ inputs.payload }}' to {{ inputs.host }}:{{ inputs.port }}"

  - id: send_tcp
    type: io.kestra.plugin.fs.tcp.Send
    description: Send a payload to a TCP endpoint (ideal for echo servers or custom services).
    host: "{{ inputs.host }}"
    port: "{{ inputs.port }}"
    payload: "{{ inputs.payload }}"

  - id: assert_send
    type: io.kestra.plugin.core.execution.Assert
    description: Fail fast if the TCP send task did not produce an output map.
    conditions:
      - "{{ outputs.send_tcp is not null }}"

extend:
  title: Send a message to a TCP endpoint
  description: |
    Send any arbitrary payload to a TCP endpoint using the Kestra TCP plugin. This is useful for testing services that accept raw TCP messages (e.g., echo servers, legacy daemons, or custom sockets).

    Prerequisites:
      - Secrets:
        - None required for a basic echo test. If your TCP service requires credentials or TLS offloading, configure those at the network layer.
      - Services:
        - A reachable TCP listener. For local testing, run an echo server with Docker:
          - `docker run --rm -p 9090:9090 alpine/socat -v tcp-listen:9090,reuseaddr,fork system:'cat'`
    Quick start:
      1. Set `host`, `port`, and `payload` inputs for your target TCP service (defaults assume a local echo server).
      2. Run the flow; the shell port check confirms reachability before sending.
      3. The Send task opens a socket and writes the payload after logging the target.
      4. The Assert task fails fast if the Send task returns no output (helpful for CI checks).
      5. Check execution logs and `outputs.send_tcp` for connection details and send metadata.
    Expected outputs:
      - outputs.send_tcp: Task output map with connection metadata from the TCP Send plugin.
  tags:
    - Infrastructure
    - Core
  ee: false
  demo: false
  meta_description: Send a custom payload to any TCP endpoint with the Kestra TCP Send plugin.
