id: datagen-mongodb
namespace: company.team

tasks:
  - id: datagen
    type: io.kestra.plugin.datagen.core.Generate
    batchSize: 100
    store: true
    generator:
      type: io.kestra.plugin.datagen.generators.JsonObjectGenerator
      locale: ["us", "US"]
      value:
        name: "#{name.fullName}"
        email: "#{internet.emailAddress}"
        age: 30
        address:
          city: "#{address.city}"
          zip: "#{address.zipCode}"
        skills: [ "#{job.keySkills}", "#{job.position}", "hardcoded" ]
        ts: "{{ now() }}"

  - id: send_to_mongodb
    type: io.kestra.plugin.mongodb.Load
    connection:
      uri: "{{ secret('MONGO_URI') }}"
    database: "{{ secret('DATABASE_NAME') }}"
    collection: "{{ secret('COLLECTION_NAME') }}"
    from: "{{ outputs.datagen.uri }}"

extend:
  title: Generate mock JSON data and send the file to MongoDB
  description: Generate 100 records of mock people data with DataGen and send the JSON to MongoDB.
  tags:
    - Tool
    - Database
  ee: false
  demo: false
  meta_description: "This flow generates 100 records of mock people data in JSON with DataGen and loads it into a MongoDB collection."
