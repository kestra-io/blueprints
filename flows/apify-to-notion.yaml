id: apify-to-notion
namespace: company.team

tasks:
  - id: run_actor
    type: io.kestra.plugin.apify.actor.Run
    actorId: GdWCkxBtKWOsKjdch
    maxItems: 1
    apiToken: "{{ secret('APIFY_API_TOKEN') }}"
    input:
      excludePinnedPosts: false
      hashtags: ["fyp"]
      resultsPerPage: 2

  - id: get_dataset
    type: io.kestra.plugin.apify.dataset.Get
    apiToken: "{{ secret('APIFY_API_TOKEN') }}"
    datasetId: "{{ outputs.run_actor.defaultDatasetId }}"

  - id: update_page
    type: io.kestra.plugin.notion.page.Update
    apiToken: "{{ secret('NOTION_API_TOKEN') }}"
    pageId: "{{ secret('NOTION_PAGE_ID') }}"
    content: |
      # Weekly Apify Scrape Result

      Actor run:
      {{ outputs.run_actor }}

      Dataset:
      {{ outputs.get_dataset }}

extend:
  shortDescription: "This flow runs on demand and: - Runs an Apify actor - Fetches the default dataset from that run - Updates a Notion page with the scraped results"
  title: Run Apify actor and update Notion
  description: |
    This flow runs on demand and:
    - Runs an Apify actor
    - Fetches the default dataset from that run
    - Updates a Notion page with the scraped results
  tags:
    - Data
  ee: false
  demo: false
  meta_description: Run an Apify actor on demand and update a Notion page with the default dataset output.
