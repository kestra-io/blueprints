id: compute_resources_approval
type: io.kestra.plugin.ee.apps.Execution
displayName: Resource request form
namespace: company.team
flowId: request_resources
access: 
  type: PRIVATE

layout:
  - on: OPEN
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Compute Resources Request Form
          Fill out the form below to request compute resources.
          Make sure to include the deadline by which the resources should be provisioned.

      - type: io.kestra.plugin.ee.apps.execution.blocks.CreateExecutionForm

      - type: io.kestra.plugin.ee.apps.execution.blocks.CreateExecutionButton
        text: Submit
        style: DEFAULT

  - on: CREATED
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Thank you for your submission!
          Your request is now forwarded to the DevOps team for approval.

      - type: io.kestra.plugin.ee.apps.core.blocks.AutoRefresh

  - on: RUNNING
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ### We're processing your request
          
      - type: io.kestra.plugin.ee.apps.core.blocks.Loading
      - type: io.kestra.plugin.ee.apps.execution.blocks.Logs
      - type: io.kestra.plugin.ee.apps.execution.blocks.CancelExecutionButton
        text: Cancel request
        style: WARNING

  - on: PAUSE
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Validate the request
          Below are the details of the request. 

      - type: io.kestra.plugin.ee.apps.execution.blocks.Inputs

      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ### Approve or Reject?
          Please approve or reject the request.

      - type: io.kestra.plugin.ee.apps.execution.blocks.ResumeExecutionForm
      - type: io.kestra.plugin.ee.apps.execution.blocks.ResumeExecutionButton
        text: Approve
        style: SUCCESS

      - type: io.kestra.plugin.ee.apps.execution.blocks.CancelExecutionButton
        text: Reject
        style: DANGER
      
  - on: RESUME
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ### Thank you for validating the request!

      - type: io.kestra.plugin.ee.apps.core.blocks.AutoRefresh

  - on: SUCCESS
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ### Request processed successfully
          See the details of the processed execution below.

      - type: io.kestra.plugin.ee.apps.execution.blocks.Inputs
      - type: io.kestra.plugin.ee.apps.execution.blocks.Outputs

      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## You're all set!
          Find more App examples in the linked repository

      - type: io.kestra.plugin.ee.apps.core.blocks.Button
        text: App examples
        url: https://github.com/kestra-io/enterprise-edition-examples
        style: INFO

      - type: io.kestra.plugin.ee.apps.core.blocks.Button
        text: Submit new request
        url: "{{ app.url }}"
        style: DEFAULT

  - on: FAILURE
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Request failed

      - type: io.kestra.plugin.ee.apps.core.blocks.Alert
        style: WARNING
        showIcon: true
        content: |
          The workflow encountered an error during processing. 

      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          Try again or contact support if the issue persists.

      - type: io.kestra.plugin.ee.apps.core.blocks.Button
        text: Submit new request
        url: "{{ app.url }}"
        style: DEFAULT

      - type: io.kestra.plugin.ee.apps.core.blocks.Button
        text: Contact support
        url: https://kestra.io/slack
        style: INFO

  - on: FALLBACK
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: You're all set. Thanks for using this app!

description: |
  This Kestra App provides a structured approval workflow for compute resource requests. 
  It allows team members to submit a resource request via a form, which is then routed 
  to the DevOps team for validation and approval before provisioning.

  The App guides the user through multiple stages:
    - **OPEN**: Collects request details with a form.
    - **CREATED**: Confirms submission and forwards the request to DevOps.
    - **RUNNING**: Displays real-time progress with logs and the option to cancel.
    - **PAUSE**: Allows DevOps to validate, approve, or reject the request.
    - **RESUME**: Acknowledges validation before resuming execution.
    - **SUCCESS**: Confirms successful processing and provides access to outputs.
    - **FAILURE**: Displays error details and options to resubmit or contact support.
    - **FALLBACK**: Generic completion message in case of unexpected states.

  This pattern ensures controlled allocation of compute resources, 
  with built-in approval steps to balance efficiency and governance.

extend:
  title: Approval-based compute resource request App
  description: |
    This Kestra App manages compute resource requests using an approval-based workflow. 
    It allows engineers to submit requests via a form and ensures each request is validated 
    by the DevOps team before provisioning.

    **How it works**
      - A user submits a request form detailing compute needs and deadlines
      - The DevOps team reviews the request during a `PAUSE` step
      - The request can be approved (resuming execution) or rejected (cancelled)
      - Upon approval, the request flow provisions resources automatically
      - The App provides real-time feedback on state changes, logs, and outputs

    **Configuration:**
      - Update the `flowId` to match the provisioning flow for your infrastructure
      - Customize form fields to capture additional details (e.g., instance type, region, duration)
      - Adjust access type (`PRIVATE` vs. `PUBLIC`) depending on team policies
      - Modify markdown blocks for team-specific instructions

    This App improves governance by enforcing approval before resource allocation 
    while keeping the user experience streamlined through a single interface.

  tags:
    - Getting Started
  ee: true
  demo: false
  meta_description: |
    Kestra App for requesting and approving compute resources. 
    Provides a form for engineers, approval steps for DevOps, and 
    automated provisioning on approval with full execution transparency.