id: vacation_approval_process
type: io.kestra.plugin.ee.apps.Execution
displayName: Vacation approval request
namespace: company.team
flowId: vacation
access: 
  type: PRIVATE

layout:
  - on: OPEN
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Submit a vacation approval request
          Submit your vacation request for approval, including your name, start and end dates.

      - type: io.kestra.plugin.ee.apps.execution.blocks.CreateExecutionForm
      - type: io.kestra.plugin.ee.apps.execution.blocks.CreateExecutionButton
        text: Submit
        style: DEFAULT

  - on: RUNNING
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Execution in progress

      - type: io.kestra.plugin.ee.apps.core.blocks.Loading
      - type: io.kestra.plugin.ee.apps.execution.blocks.Logs
      - type: io.kestra.plugin.ee.apps.execution.blocks.CancelExecutionButton
        text: Cancel request
        style: WARNING

  - on: PAUSE
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Validate the request
          Below are the details of the request. 

      - type: io.kestra.plugin.ee.apps.execution.blocks.Inputs
      - type: io.kestra.plugin.ee.apps.execution.blocks.TaskOutputs
        outputs:
          - displayName: Employee Data
            type: FILE
            value: "{{ outputs.fetch_employee_data.uri }}"

      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Approve or Reject?
          Please approve or reject the request.

      - type: io.kestra.plugin.ee.apps.execution.blocks.ResumeExecutionForm
      - type: io.kestra.plugin.ee.apps.execution.blocks.ResumeExecutionButton
        text: Approve
        style: SUCCESS

      - type: io.kestra.plugin.ee.apps.execution.blocks.CancelExecutionButton
        text: Reject
        style: DANGER

      - type: io.kestra.plugin.ee.apps.core.blocks.AutoRefresh

  - on: RESUME
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Thank you for validating the request!

      - type: io.kestra.plugin.ee.apps.core.blocks.AutoRefresh

  - on: SUCCESS
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## Request processed successfully
          See the logs below.

      - type: io.kestra.plugin.ee.apps.execution.blocks.Logs

      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: |
          ## You're all set!
          See more App examples in our GitHub repository

      - type: io.kestra.plugin.ee.apps.core.blocks.Button
        text: App examples
        url: https://github.com/kestra-io/enterprise-edition-examples
        style: INFO

  - on: FALLBACK
    blocks:
      - type: io.kestra.plugin.ee.apps.core.blocks.Markdown
        content: You're all set. Thanks for using this app!

description: |
  This Kestra App manages vacation approval requests through a structured workflow.
  Employees submit their vacation details via a form, and the request pauses 
  for HR or a manager to validate and approve or reject. 

  The App includes:
    - **OPEN**: Collect and submit vacation request details
    - **RUNNING**: Display execution progress and logs
    - **PAUSE**: Allow HR or managers to review request details and employee data before approving or rejecting
    - **RESUME**: Acknowledge validation and continue execution
    - **SUCCESS**: Confirm successful request processing with logs
    - **FALLBACK**: Provide a generic completion message

  This flow ensures vacation requests are formally captured, reviewed, and documented,
  reducing manual overhead while providing transparency for both employees and HR.

extend:
  title: Vacation approval App
  description: |
    This Kestra App streamlines the vacation approval process by 
    combining employee self-service with an HR validation step.

    **How it works**
      - Employees fill out a form with their name, start date, and end date
      - The request is logged and moves into a `PAUSE` step for HR/manager review
      - Employee data is attached as a file output for reference
      - HR or a manager can approve (resuming execution) or reject the request
      - Once approved, the process completes successfully and is logged

    **Configuration:**
      - Update the `flowId` to connect with your HR workflow
      - Customize the form fields to capture more details (e.g., department, backup coverage)
      - Adjust access type (`PRIVATE` vs. `PUBLIC`) depending on your organizationâ€™s HR policy
      - Modify markdown messages for company-specific communication style

    This App helps automate vacation requests, 
    ensuring each request is approved before becoming official, 
    while providing employees with transparency and HR with governance.

    **Connected Flows**

    ```yaml
    id: vacation
    namespace: company.team

    inputs:
      - id: request.name
        type: STRING
        displayName: Employee name

      - id: request.start_date
        type: DATE
        displayName: Start date

      - id: request.end_date
        type: DATE
        displayName: End date

    tasks:
      - id: fetch_employee_data
        type: io.kestra.plugin.core.http.Download
        uri: https://huggingface.co/datasets/kestra/datasets/resolve/main/employees/employees00.csv
        
      - id: send_approval_request
        type: io.kestra.plugin.notifications.slack.SlackIncomingWebhook
        url: https://reqres.in/api/slack
        payload: >
          {
            "channel": "#vacation",
            "text": "Validate holiday request for {{ inputs.request.name }}. To approve the request, click on the `Resume` button here http://localhost:8080/ui/executions/{{flow.namespace}}/{{flow.id}}/{{execution.id}}"
          }

      - id: wait_for_approval
        type: io.kestra.plugin.core.flow.Pause
        onResume:
          - id: comment
            description: Extra comments about the provisioned resources
            type: STRING
            defaults: Vacation request approved. Enjoy your time off!
            displayName: Approval Comment

      - id: process_request
        type: io.kestra.plugin.core.http.Request
        uri: https://reqres.in/api/products
        method: POST
        contentType: application/json
        body: "{{ inputs.request }}"
    ```

  tags:
    - Getting Started
  ee: true
  demo: false
  meta_description: |
    Kestra App for vacation requests. Employees submit their dates, 
    HR validates and approves or rejects. Automates the request/approval 
    cycle with full visibility into status and logs.
